server {
    listen 80;
    server_name localhost;
    
    root /var/www/html;
    index index.html index.htm;
    
    # APT repository location
    location /apt/ {
        alias /var/lib/aptly/.aptly/public/;
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        
        # Allow access to repository files
        location ~ \.deb$ {
            add_header Content-Type application/vnd.debian.binary-package;
        }
        
        location ~ (Release|Packages|Sources)(\.gz|\.bz2)?$ {
            add_header Content-Type text/plain;
        }
    }
    
    # GPG key location
    location /pds-repo.gpg {
        add_header Content-Type application/pgp-keys;
    }
    
    # Health check endpoint
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
    
    # Root page with repository information
    location = / {
        return 200 '<!DOCTYPE html>
<html>
<head>
    <title>PDS APT Repository</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .code { background: #f4f4f4; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .header { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">PDS APT Repository</h1>
        
        <h2>Setup Instructions</h2>
        <p>Add this repository to your system:</p>
        <div class="code">
            <pre># Add GPG key
curl -fsSL http://YOUR_HOST/pds-repo.gpg | sudo tee /usr/share/keyrings/pds-repo.gpg >/dev/null

# Add repository
echo "deb [signed-by=/usr/share/keyrings/pds-repo.gpg] http://YOUR_HOST/apt/ stable main" | sudo tee /etc/apt/sources.list.d/pds-repo.list

# Update and install
sudo apt update
sudo apt install pds</pre>
        </div>
        
        <h2>Repository Contents</h2>
        <ul>
            <li><a href="/apt/">Browse repository files</a></li>
            <li><a href="/pds-repo.gpg">Download GPG key</a></li>
        </ul>
        
        <h2>Package Information</h2>
        <p>This repository contains the PDS (Portable Deploy Suite) package with comprehensive Bash functions for software installation, UI setup, and system deployment.</p>
        
        <h2>Health Check</h2>
        <p><a href="/health">Repository health status</a></p>
    </div>
</body>
</html>';
        add_header Content-Type text/html;
    }
}
